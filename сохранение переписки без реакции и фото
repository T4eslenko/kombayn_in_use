def get_private_messages(client, target_user, userinfo):
    # Устанавливаем часовой пояс Минска
    minsk_timezone = timezone('Europe/Minsk')
    
    # Получаем информацию о пользователе
    user = client.get_entity(target_user)  # Получаем сущность пользователя
    username = f'@{user.username}' if user.username else ""
    first_name = user.first_name if user.first_name else ''
    last_name = user.last_name if user.last_name else ''
    user_id = user.id
   
    # Создаем заголовок
    header = f"<h1>Переписка с: {user_id}, {username}, {first_name}, {last_name} #Выгрузка личных сообщений</h1>"
    
    html_output = f"<html><head><title>Переписка</title><style>blockquote {{ background-color: #f2f2f2; }} em {{ font-style: italic; }}</style></head><body>{header}"
    try:
        for message in client.iter_messages(target_user):
            # Преобразуем время сообщения во время Минска
            message_time = message.date.astimezone(minsk_timezone).strftime('%Y-%m-%d %H:%M:%S')

            html_output += f"<p><strong>Дата и время:</strong> {message_time}</p>"
            if message.reply_to_msg_id:
                # Если есть ответ на сообщение, цитируем его
                original_message = client.get_messages(target_user, ids=message.reply_to_msg_id)
                html_output += f"<blockquote><em>{escape(original_message.text)}</em></blockquote>"
            html_output += f"<p><strong>Сообщение:</strong> {escape(message.text)}</p>"
            html_output += "<hr>"
    except Exception as e:
        html_output += f"<p>Ошибка при получении переписки: {e}</p>"
    html_output += "</body></html>"
    
    filename = f"{target_user}_private_messages.html"
    with open(filename, "w", encoding="utf-8") as file:
        file.write(html_output)
    print(f"HTML-файл сохранен как '{filename}'")
